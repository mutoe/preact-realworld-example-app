import{l as a,a as t,u as e,m as n,D as s,c as o,d as r,e as c,f as l,g as i,y as u,h as m,b as d}from"../index.01fc4fba.js";import{a as p,b as $}from"./profile.503154b6.js";const g={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function h(a){return a.replace(RegExp("^"+(a.match(/^(\t| )+/)||"")[0],"gm"),"")}function f(a){return(a+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function b(a,t){let e,n,s,o,r,c=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,l=[],i="",u=t||{},m=0;function d(a){let t=g[a[1]||""],e=l[l.length-1]==a;return t?t[1]?(e?l.pop():l.push(a),t[0|e]):t[0]:a}function p(){let a="";for(;l.length;)a+=d(l[l.length-1]);return a}for(a=a.replace(/^\[(.+?)\]:\s*(.+)$/gm,((a,t,e)=>(u[t.toLowerCase()]=e,""))).replace(/^\n+|\n+$/g,"");s=c.exec(a);)n=a.substring(m,s.index),m=c.lastIndex,e=s[0],n.match(/[^\\](\\\\)*\\$/)||((r=s[3]||s[4])?e='<pre class="code '+(s[4]?"poetry":s[2].toLowerCase())+'"><code'+(s[2]?` class="language-${s[2].toLowerCase()}"`:"")+">"+h(f(r).replace(/^\n+|\n+$/g,""))+"</code></pre>":(r=s[6])?(r.match(/\./)&&(s[5]=s[5].replace(/^\d+/gm,"")),o=b(h(s[5].replace(/^\s*[>*+.-]/gm,""))),">"==r?r="blockquote":(r=r.match(/\./)?"ol":"ul",o=o.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),e="<"+r+">"+o+"</"+r+">"):s[8]?e=`<img src="${f(s[8])}" alt="${f(s[7])}">`:s[10]?(i=i.replace("<a>",`<a href="${f(s[11]||u[n.toLowerCase()])}">`),e=p()+"</a>"):s[9]?e="<a>":s[12]||s[14]?(r="h"+(s[14]?s[14].length:s[13]>"="?1:2),e="<"+r+">"+b(s[12]||s[15],u)+"</"+r+">"):s[16]?e="<code>"+f(s[16])+"</code>":(s[17]||s[1])&&(e=d(s[17]||"--"))),i+=n,i+=e;return(i+a.substring(m)+p()).replace(/^\n+|\n+$/g,"")}const v=a=>new Date(a).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});function w(l){const[i,u]=a(l.article),m=t((a=>a.user)),d=e();return n`<div class="article-meta"><a href=${`/@${i.author.username}`}><img src=${i.author.image||s} alt="User's profile picture"/></a><div class="info"><a href=${`/@${i.author.username}`} class="author">${i.author.username}</a><span class="date">${v(i.createdAt)}</span></div>${function(a){let t,e=a[0],n=1;for(;n<a.length;){const s=a[n],o=a[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==e)return;"access"===s||"optionalAccess"===s?(t=e,e=o(e)):"call"!==s&&"optionalCall"!==s||(e=o(((...a)=>e.call(t,...a))),t=void 0)}return e}([m,"optionalAccess",a=>a.username])===i.author.username?n`<a class="btn btn-sm btn-outline-secondary" href=${`/editor/${i.slug}`}><i class="ion-edit"/> Edit Article </a> <button class="btn btn-sm btn-outline-danger" onClick=${async()=>{await o(i.slug),d.route("/")}}><i class="ion-trash-a"/> Delete Article </button>`:n`<button class=${"btn btn-sm "+(i.author.following?"btn-secondary":"btn-outline-secondary")} onClick=${async()=>{const a=i.author.following?await p(i.author.username):await $(i.author.username);u({...i,author:a})}}><i class="ion-plus-round"/> ${i.author.following?"Unfollow":"Follow"} ${i.author.username}</button> <button class=${"btn btn-sm "+(i.favorited?"btn-primary":"btn-outline-primary")} onClick=${async()=>u(i.favorited?await r(i.slug):await c(i.slug))}><i class="ion-heart"/> Favorite Article <span class="counter">(${i.favoritesCount})</span></button>`}</div>`}function y(a){const{comment:e}=a,o=t((a=>a.user));return n`<div class="card"><div class="card-block"><p class="card-text">${e.body}</p></div><div class="card-footer"><a href=${`/@${e.author.username}`} class="comment-author"><img src=${e.author.image||s} class="comment-author-img" alt="User's profile picture"/></a> <a href=${`/@${e.author.username}`} class="comment-author">${e.author.username}</a><span class="date-posted">${v(e.createdAt)}</span><span class="mod-options">${function(a){let t,e=a[0],n=1;for(;n<a.length;){const s=a[n],o=a[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==e)return;"access"===s||"optionalAccess"===s?(t=e,e=o(e)):"call"!==s&&"optionalCall"!==s||(e=o(((...a)=>e.call(t,...a))),t=void 0)}return e}([o,"optionalAccess",a=>a.username])===e.author.username&&n`<i class="ion-trash-a" onClick=${async()=>{await async function(a,t){try{await l.delete(`articles/${a}/comments/${t}`)}catch(e){throw i(e,"error while deleting comment")}}(a.articleSlug,e.id),a.onDelete()}} aria-label="Delete comment"/>`}</span></div></div>`}function C(e){const[o,r]=a(void 0),[c,p]=a([]),[$,g]=a(""),[h,f]=a(!1),v=t((a=>a.user));return u((()=>{!async function(){f(!0),r(await m(e.params.slug)),p(await async function(a){try{const{data:t}=await l.get(`articles/${a}/comments`);return t.comments}catch(t){throw i(t,"error while fetching comments")}}(e.params.slug)),f(!1)}()}),[e.params.slug]),o?n`<div class="article-page"><div class="banner"><div class="container"><h1>${o.title}</h1><${w} article=${o}/></div></div><div class="container page"><div class="row article-content"><div class="col-xs-12" dangerouslySetInnerHTML=${{__html:b(o.body)}}/></div><hr/><div class="article-actions"><${w} article=${o}/></div><div class="row"><div class="col-xs-12 col-md-8 offset-md-2"><form class="card comment-form" onSubmit=${async a=>{a.preventDefault();const t=await async function(a,t){try{const{data:e}=await l.post(`articles/${a}/comments`,{comment:{body:t}});return e.comment}catch(e){throw i(e,"error while creating comment")}}(e.params.slug,$);g(""),p((a=>[t,...a]))}}><div class="card-block"><textarea value=${$} class="form-control" placeholder="Write a comment..." rows=${3} onInput=${a=>g(a.currentTarget.value)}/></div><div class="card-footer"><img src=${function(a){let t,e=a[0],n=1;for(;n<a.length;){const s=a[n],o=a[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==e)return;"access"===s||"optionalAccess"===s?(t=e,e=o(e)):"call"!==s&&"optionalCall"!==s||(e=o(((...a)=>e.call(t,...a))),t=void 0)}return e}([v,"optionalAccess",a=>a.image])||s} class="comment-author-img"/><button class="btn btn-sm btn-primary">Post Comment</button></div></form>${c.map((a=>n`<${y} key=${a.id} articleSlug=${e.params.slug} comment=${a} onDelete=${()=>p((t=>t.filter((t=>t.id!==a.id))))}/>`))}</div></div></div></div>`:n`<${d} show=${h} style=${{margin:"1rem auto",display:"flex"}} width="2em"/>`}export default C;